# RPN記法を用いたtex数式の表現

このレポート課題で作成したBisonファイルは以下のリンクにある。README.mdファイルに概要が書かれているので参照していただきたい。

- https://github.com/acesulfamK/rpn-tex

# 概要

プロジェクトは、texの数式表現に対して、RPN記法を独自に定義しそれを用いて簡潔に記述できるようにしたものである。プログラムの動作は、RPN記法で書かれた数式をtexの数式表記に戻すというものである。

RPN記法(逆ポーランド記法)とは計算式の書き方の一つで、従来用いられている中置記法("3+4"のような書き方)と違い、"3 4 +"のように演算子を最後につける記法である。
この記法を用いてると、括弧を用いることなく数式の構造を表せる。例えば、"(1+2)+(3+4)"は"1 2 + 3 4 + +"となる。

# 動機

texの数式表記は括弧が多用されていて使いにくいと感じる。そこで、括弧を用いないRPN記法でtexの数式を表すことができないかというモチベーションでこのプログラムを作った。

# 原理

## texの記法の概要
    
    texの数式表記では、主に最初に数式の構造(分数や、演算記号など)を宣言し、その後記号のオペランドを中括弧で括って続けて書くという方式をとっている。例えば、「二分の一」は以下のように表される。
    ```
    \frac{1}{2}
    ```
    この際、`\frac`は、分数を表す記号でありそれが続く1,2に適用される。
    
    この表記は

## RPN記法の概要
    
    RPN記法は逆ポーランド記法とも呼ばれ、数式や計算を表現するための記法である。
    通常の数式表記法は`3+4`のようにオペランドの間に演算子をおいて表現するのに対して、RPNでは`3 4 +`のように2つのオペランドの後に演算子を置く。
    複雑な式の場合も同様に表記していく。
    例えば、`(3+4)+(5+6)`をRPNで表記すると、これは`3 4 +`と`5 6 +`の和であるからこれら2式をオペランドとして、`3 4 + 5 6 + +`となる。
    
    RPNに慣れていない人がRPNで書かれた数式を計算する際には、左から数式を読んでいき、`オペランド　オペランド 演算子`の並びが出てきたら、そこをこの計算結果で書き換える。その後、もう一度数式の左端に戻り同様に読んでいくという方法がわかりやすい。これは一見RPNが計算の面倒な記法に感じられるが、スタックを用いればもっと早く計算が可能であったり、右から読めば構文の概要がわかったり、とむしろ便利な側面も多く持つ。
    
    RPN表記の持つ主な利点を以下にあげる。特に、初めの2つの性質は、今回のtex数式のRPN記法のモチベーションにもなっている。
    
    - 括弧を用いずに明確に計算順序を指定できる。
    - 演算子の左右結合優先度を指定する必要がない。
    - スタック1つの簡易な計算機でも計算できる。
    
# 結果(完成したプログラムの使用)

## 使用方法

rpn-tex/plus-string.tab.c をgccなどでコンパイルし、実行ファイルを作成。
実行ファイルを実行すると、入力を受け付ける

## 実行例

試しに、フーリエ級数展開の公式を書いてみる

input

```
1 T @f @i  - T 2 @f & _  T 2 @f ^ & f(t) & e  -i 2pi T @f &  nt & ^ & dt & 
```

output

```
\frac{1}{T}\int_{-\frac{T}{2}}^{\frac{T}{2}}f(t)e^{-i\frac{2pi}{T}nt}dt
```

## 実装した文法

- @f: frac
- ^: ^{}
- _: _{}
- &: cat(この記号の前に連続して書かれた2つの数式を結合する)
- ): ()(直前に現れた数式を括弧で括る)
- @i: \int

# 考察

## Bisonを使用してみて

Bisonには、演算子の結合優先度や結合方向(左右)を指定する機能があるが、RPN記法は元から演算子の結合方向や優先度の指定を必要としないことから、あまりBisonの多様な機能を活かせなかったと思った。しかし、BNF記法を用いたことにより再帰的に処理を書くことができて便利だと思った。

## 実際にtexのRPN記法を使用してみて

良いと思った点は、フーリエ級数展開の公式の例を見ればわかるとおり、同じ数式に対して、必要な文字数は格段に減った(空白を除く)ところや、構文規則としてsymbolの間は空白であけなければいけないことから自然と文章のの可読性が上がったことである。
悪いと思った点は、括弧がなくなったことで、式の構造が捉えづらくなったことである。しかし、これは慣れの問題かもしれない。

## その他思ったこと

Bisonのチュートリアルや利用例を多くみたが、ファイルからの文字列の入出力をうまく行うことができなかった。このレポートを読んだかたでBisonの利用に長けている方がいたら教えて欲しい(https://github.com/acesulfamK/rpn-texまで)。





